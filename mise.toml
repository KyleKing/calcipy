[env]
_.python.venv = {path = ".venv"}

[tasks.test]
description = "Run tests with default Python version"
run = "{{vars.test_cmd}}"

[tasks."test:310"]
description = "Run tests with Python 3.10"
env = {RUNTIME_TYPE_CHECKING_MODE = "{{vars.runtime_mode}}"}
run = "{{vars.test_cmd}}"
tools.python = "{{vars.py_310}}"

[tasks."test:311"]
description = "Run tests with Python 3.11"
env = {RUNTIME_TYPE_CHECKING_MODE = "{{vars.runtime_mode}}"}
run = "{{vars.test_cmd}}"
tools.python = "{{vars.py_311}}"

[tasks."test:312"]
description = "Run tests with Python 3.12"
env = {RUNTIME_TYPE_CHECKING_MODE = "{{vars.runtime_mode}}"}
run = "{{vars.test_cmd}}"
tools.python = "{{vars.py_312}}"

[tasks."test:all"]
depends = ["test:310", "test:311", "test:312"]
description = "Run tests on all supported Python versions (sequential)"

[tasks."test:all-verbose"]
description = "Run tests on all Python versions with explicit output"
run = '''
#!/usr/bin/env bash
set -euo pipefail
echo "Testing across Python 3.10, 3.11, 3.12..."
echo ""
echo "=== Testing Python 3.10.11 ==="
mise run test:310 || exit 1
echo ""
echo "=== Testing Python 3.11.11 ==="
mise run test:311 || exit 1
echo ""
echo "=== Testing Python 3.12.5 ==="
mise run test:312 || exit 1
echo ""
echo "âœ“ All Python versions passed"
'''

[tools]
python = ["3.10.11", "3.11.11", "3.12.5"]

[vars]
py_310 = "3.10.11"
py_311 = "3.11.11"
py_312 = "3.12.5"
# Python versions - single source of truth
runtime_mode = "WARNING"
# Shared test configuration
test_cmd = "uv run --group ci pytest tests/"
